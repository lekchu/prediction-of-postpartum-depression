# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1y8-1w7T4q10Jv0GAkrZ0xTe87SD_TdM7
"""



import streamlit as st
import numpy as np
import joblib
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.preprocessing import LabelEncoder

# Load trained model and label encoder
model = joblib.load('ppd_model_pipeline.pkl')
le = joblib.load('label_encoder.pkl')

st.title("Postpartum Depression Risk Predictor")
st.header("About", divider="gray")
st.markdown("""
# üß† Postpartum Depression Predictor

This application is designed to **assess and predict the risk levels** of postpartum depression using a machine learning model trained on questionnaire responses and demographic inputs.

It provides:
- Insights into potential mental health conditions
- Personalized risk categories: *Mild*, *Moderate*, *Severe*, or *Profound*
- Supportive feedback based on the model‚Äôs prediction

> ‚ö†Ô∏è **Disclaimer**: This tool is for informational and educational purposes only. It is **not a substitute for professional diagnosis or medical advice**. If you are experiencing symptoms, please consult a healthcare provider.
""")

Age=st.slider("Age",18,45,25)
st.selectbox("Are you currently pregnant",["select..","Yes","No"])
st.selectbox("Have you given birth recently",["select..","Yes","No"])

FamilySupport=st.selectbox("Dou you have Family support",["Low","Medium","High"])

Q1_response={"As much as I always could":0,
             "Not quite so much now":1,
             "Definitely not so much now":2,
             "Not at all":3}
Q2_response={"As much as I ever did":0,
             "Rather less than I used to":1,
             "Definitely less than I used to":2,
             "Hardly at all":3}
Q3_response={"Yes, most of the time":3,
             "Yes, some of the time":2,
             "Not very often":1,
             "No, never":0}
Q4_response={"No, not at all":0,
             "Hardly ever":1,
             "Yes, sometimes":2,
             "Yes, very often":3}
Q5_response={"Yes, quite a lot":3,
             "Yes, sometimes":2,
             "No, not much":1,
             "No, not at all":0}
Q6_response={"Yes, most of the time I haven't been able to cope at all":3,
             "Yes, sometimes I haven't been coping as well as usual":2,
             "No, most of the time I have coped quite well":1,
             "No, I have been coping as well as ever":0}
Q7_response={"Yes, most of the time":3,
             "Yes, sometimes":2,
             "Not very often":1,
             "No, not at all":0}
Q8_response={"Yes, most of the time":3,
             "Yes, quite often":2,
             "Not very often":1,
             "No, not at all":0}
Q9_response={"Yes, most of the time":3,
             "Yes, quite often":2,
             "Only occasionally":1,
             "No, never":0}
Q10_response={"Yes, quite often":3,
              "Sometimes":2,
              "Hardly ever":1,
              "Never":0}


Q1=st.selectbox("1. I have been able to laugh and see the funny side of things.",list(Q1_response.keys()))
Q2=st.selectbox("2. I have looked forward with enjoyment to things",list(Q2_response.keys()))
Q3=st.selectbox("3. I have blamed myself unnecessarily when things went wrong",list(Q3_response.keys()))
Q4=st.selectbox("4. I have been anxious or worried for no good reason",list(Q4_response.keys()))
Q5=st.selectbox("5. I have felt scared or panicky for no very good reason",list(Q5_response.keys()))
Q6=st.selectbox("6. Things have been getting on top of me",list(Q6_response.keys()))
Q7=st.selectbox("7. I have been so unhappy that I have had difficulty sleeping",list(Q7_response.keys()))
Q8=st.selectbox("8. I have felt sad or miserable",list(Q8_response.keys()))
Q9=st.selectbox("9, I have been so unhappy that I have been crying",list(Q9_response.keys()))
Q10=st.selectbox("10. The thought of harming myself has occurred to me",list(Q10_response.keys()))

q1_val = Q1_response[Q1]
q2_val = Q2_response[Q2]
q3_val = Q3_response[Q3]
q4_val = Q4_response[Q4]
q5_val = Q5_response[Q5]
q6_val = Q6_response[Q6]
q7_val = Q7_response[Q7]
q8_val = Q8_response[Q8]
q9_val = Q9_response[Q9]
q10_val = Q10_response[Q10]
score=q1_val+q2_val+q3_val+q4_val+q5_val+q6_val+q7_val+q8_val+q9_val+q10_val

input_data = pd.DataFrame([{
    "Age": Age,
    "FamilySupport": FamilySupport,
    "Q1": q1_val,
    "Q2": q2_val,
    "Q3": q3_val,
    "Q4": q4_val,
    "Q5": q5_val,
    "Q6": q6_val,
    "Q7": q7_val,
    "Q8": q8_val,
    "Q9": q9_val,
    "Q10": q10_val,
    "EPDS_Score" :score
}])

prediction_encoded = model.predict(input_data)[0]
prediction_label = le.inverse_transform([prediction_encoded])[0]

st.success(f" Predicted Postpartum Depression Risk: **{prediction_label}**")

import matplotlib.pyplot as plt

fig, ax = plt.subplots()
ax.bar(["Risk"], [prediction_encoded], color='salmon')
ax.set_ylim([0, 3])
ax.set_ylabel("Risk Level (0: Mild to 3: Profound)")
st.pyplot(fig)
